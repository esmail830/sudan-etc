# ุญู ูุดููุฉ RLS (Row Level Security)

## ๐จ ุงููุดููุฉ:
```
PostgrestException: new row violates row-level security policy for table "reportc"
code: 42501, details: Unauthorized
```

## ๐ **ูุง ุชุนููู ุงููุดููุฉ:**
- RLS ููุนู ุนูู ุงูุฌุฏูู
- ุงูุณูุงุณุงุช ูุง ุชุณูุญ ุจุฅุฏุฑุงุฌ ุจูุงูุงุช ุฌุฏูุฏุฉ
- ุงููุณุชุฎุฏู ุบูุฑ ูุตุฑุญ ูู ุจุฅูุดุงุก ุจูุงุบุงุช

## โ **ุงูุญู ุงูุณุฑูุน:**

### **ุงูุฎุทูุฉ 1: ููุฐ ููู ุฅุตูุงุญ RLS**
1. ุงุฐูุจ ุฅูู Supabase Dashboard
2. ุงุฐูุจ ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุญุชูู `fix_rls_policies.sql`
4. ููุฐ ุงูุฃูุงูุฑ

### **ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ**
```sql
-- ุงุฎุชุจุงุฑ ุฅุฏุฑุงุฌ ุจูุงูุงุช
INSERT INTO reportc (type, description, location, legal_agreement_accepted, status)
VALUES ('ุงุฎุชุจุงุฑ', 'ูุตู ุงุฎุชุจุงุฑ', 'ูููุน ุงุฎุชุจุงุฑ', true, 'pending');

-- ุนุฑุถ ุงููุชูุฌุฉ
SELECT * FROM reportc WHERE type = 'ุงุฎุชุจุงุฑ';

-- ุญุฐู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
DELETE FROM reportc WHERE type = 'ุงุฎุชุจุงุฑ';
```

## ๐ง **ูุง ุชู ุฅุตูุงุญู:**

### **1. ุญุฐู ุงูุณูุงุณุงุช ุงููุฏููุฉ**
- ุฅุฒุงูุฉ ุฌููุน ุงูุณูุงุณุงุช ุงูููุฌูุฏุฉ
- ุชูุธูู ุงูุฌุฏูู ูู ุงูุณูุงุณุงุช ุงููุนุทูุฉ

### **2. ุฅูุดุงุก ุณูุงุณุงุช ุฌุฏูุฏุฉ ุตุญูุญุฉ**
- **INSERT**: ุฃู ุดุฎุต ููููู ุฅูุดุงุก ุจูุงุบ
- **SELECT**: ุฃู ุดุฎุต ููููู ูุฑุงุกุฉ ุงูุจูุงุบุงุช
- **UPDATE**: ุงููุณุชุฎุฏู ููููู ุชุญุฏูุซ ุจูุงุบุงุชู ููุท
- **DELETE**: ุงููุณุชุฎุฏู ููููู ุญุฐู ุจูุงุบุงุชู ููุท

### **3. ุงุฎุชุจุงุฑ ุงูุณูุงุณุงุช**
- ุฅุฏุฑุงุฌ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
- ุงูุชุญูู ูู ูุฌุงุญ ุงูุนูููุฉ
- ุญุฐู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ

## ๐ **ุฎุทูุงุช ุงูุชุดุฎูุต:**

### **ูุญุต ุงูุณูุงุณุงุช ุงูุญุงููุฉ:**
```sql
-- ุนุฑุถ ุงูุณูุงุณุงุช ุงููุดุทุฉ
SELECT 
    policyname,
    cmd,
    permissive,
    roles
FROM pg_policies 
WHERE tablename = 'reportc';
```

### **ูุญุต ุญุงูุฉ RLS:**
```sql
-- ูุญุต ุญุงูุฉ RLS
SELECT 
    schemaname,
    tablename,
    rowsecurity
FROM pg_tables 
WHERE tablename = 'reportc';
```

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### **1. RLS ููุนู**
- ูุฌุจ ุฃู ูููู RLS ููุนู ุนูู ุงูุฌุฏูู
- ุจุฏูู RLSุ ูู ุชุนูู ุงูุณูุงุณุงุช

### **2. ุงูุณูุงุณุงุช ุงูุตุญูุญุฉ**
- `INSERT WITH CHECK (true)` - ูุณูุญ ุจุงูุฅุฏุฑุงุฌ
- `SELECT USING (true)` - ูุณูุญ ุจุงููุฑุงุกุฉ
- `UPDATE/DELETE` - ูุณูุญ ูููุณุชุฎุฏููู ุจุชุนุฏูู ุจูุงุบุงุชูู ููุท

### **3. ุงุฎุชุจุงุฑ ุงูุณูุงุณุงุช**
- ุชุฃูุฏ ูู ูุฌุงุญ ุงูุฅุฏุฑุงุฌ ุงูุชุฌุฑูุจู
- ุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก

## ๐ฏ **ุจุนุฏ ุงูุฅุตูุงุญ:**

1. **ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู**
2. **ุงุถุบุท ุนูู ุฃููููุฉ โน๏ธ ูุงุฎุชุจุงุฑ ุงูุงุชุตุงู**
3. **ุญุงูู ุฅุฑุณุงู ุจูุงุบ ุฌุฏูุฏ**
4. **ุชุญูู ูู ุนุฏู ุธููุฑ ุฎุทุฃ RLS**

## ๐ **ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:**

1. ููุฐ `fix_rls_policies.sql` ูุฑุฉ ุฃุฎุฑู
2. ุชุญูู ูู Console logs
3. ุฑุงุฌุน Supabase Dashboard
4. ุชุฃูุฏ ูู ูุฌุงุญ ุงุฎุชุจุงุฑ ุงูุฅุฏุฑุงุฌ ุงูุชุฌุฑูุจู

## ๐ **ุงูุฃูุงู:**

- RLS ูุญูู ุงูุจูุงูุงุช
- ุงููุณุชุฎุฏููู ูุฑูู ุจูุงุบุงุชูู ููุท
- ุฃู ุดุฎุต ููููู ุฅูุดุงุก ุจูุงุบ ุฌุฏูุฏ
- ุงูุชุญุฏูุซ ูุงูุญุฐู ูููุฏุงู ูููุงูู
